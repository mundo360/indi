var Zg=Object.defineProperty,nI=g=>{throw TypeError(g)},lg=(g,A,I)=>A in g?Zg(g,A,{enumerable:!0,configurable:!0,writable:!0,value:I}):g[A]=I,c=(g,A,I)=>lg(g,typeof A!="symbol"?A+"":A,I),yI=(g,A,I)=>A.has(g)||nI("Cannot "+I),B=(g,A,I)=>(yI(g,A,"read from private field"),I?I.call(g):A.get(g)),o=(g,A,I)=>A.has(g)?nI("Cannot add the same private member more than once"):A instanceof WeakSet?A.add(g):A.set(g,I),i=(g,A,I,Q)=>(yI(g,A,"write to private field"),Q?Q.call(g,I):A.set(g,I),I),U=(g,A,I)=>(yI(g,A,"access private method"),I),sA,iA,LA,rA,l,wA,MI,JI,aA,zA,hI,bI,cI,y,gA,SI,n,eA,KA,YI,PI,sI,jI,GA,b,X,QA,oA,uA,HA,NA,qA,vA,LI,a,fI,aI,dA,mI,rI,zI,KI,HI,eI,uI,vI,_I,$I,_A,$A,AI,tA,II,VA,FA,xA,gI,qI,CA,RA,UA,QI,dI,BA,P,f,u,v,kA,yA,EA,tI,Ag,Ig,gg,T,_,DA,TA,MA,JA,pA,hA,cA,ZA,CI,VI;import*as w from"three";import{UniformsUtils as Xg,UniformsLib as Og,MathUtils as xI}from"three";function Qg(g,A){return new Promise(I=>{g.addEventListener("message",function Q({data:C}){C?.type===A&&(g.removeEventListener("message",Q),I(C))})})}Qg(self,"wasm_bindgen_worker_init").then(async({init:g,receiver:A})=>{const I=await Promise.resolve().then(()=>IQ);await I.default(g),postMessage({type:"wasm_bindgen_worker_ready"}),I.wbg_rayon_start_worker(A)});async function Wg(g,A,I){if(I.numThreads()===0)throw new Error("num_threads must be > 0.");const Q={type:"wasm_bindgen_worker_init",init:{module_or_path:g,memory:A},receiver:I.receiver()};await Promise.all(Array.from({length:I.numThreads()},async()=>{const C=new Worker(new URL(""+new URL("tdvgs/worker0.js",import.meta.url).href,import.meta.url),{type:"module"});return C.postMessage(Q),await Qg(C,"wasm_bindgen_worker_ready"),C})),I.build()}let E;function j(g){return g==null}function m(g){const A=E.__externref_table_alloc();return E.__wbindgen_export_1.set(A,g),A}function H(g,A){try{return g.apply(this,A)}catch(I){const Q=m(I);E.__wbindgen_exn_store(Q)}}let lA=null;function q(){return(lA===null||lA.buffer!==E.memory.buffer)&&(lA=new DataView(E.memory.buffer)),lA}let K=0;function Cg(g,A){const I=A(g.length*4,4)>>>0;for(let Q=0;Q<g.length;Q++){const C=m(g[Q]);q().setUint32(I+4*Q,C,!0)}return K=g.length,I}const Bg=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Bg.decode();let XA=null;function OA(){return(XA===null||XA.buffer!==E.memory.buffer)&&(XA=new Uint8Array(E.memory.buffer)),XA}function r(g,A){return g=g>>>0,Bg.decode(OA().slice(g,g+A))}const Eg=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ng=function(g,A){const I=Eg.encode(g);return A.set(I),{read:g.length,written:I.length}};function $(g,A,I){if(I===void 0){const N=Eg.encode(g),R=A(N.length,1)>>>0;return OA().subarray(R,R+N.length).set(N),K=N.length,R}let Q=g.length,C=A(Q,1)>>>0;const D=OA();let G=0;for(;G<Q;G++){const N=g.charCodeAt(G);if(N>127)break;D[C+G]=N}if(G!==Q){G!==0&&(g=g.slice(G)),C=I(C,Q,Q=G+g.length*3,1)>>>0;const N=OA().subarray(C+G,C+Q),R=ng(g,N);G+=R.written,C=I(C,Q,G,1)>>>0}return K=G,C}const Dg=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(g=>{E.__wbindgen_export_7.get(g.dtor)(g.a,g.b)});function TI(g,A,I,Q){const C={a:g,b:A,cnt:1,dtor:I},D=(...G)=>{C.cnt++;const N=C.a;C.a=0;try{return Q(N,C.b,...G)}finally{--C.cnt===0?(E.__wbindgen_export_7.get(C.dtor)(N,C.b),Dg.unregister(C)):C.a=N}};return D.original=C,Dg.register(D,C,C),D}function pI(g){const A=typeof g;if(A=="number"||A=="boolean"||g==null)return`${g}`;if(A=="string")return`"${g}"`;if(A=="symbol"){const C=g.description;return C==null?"Symbol":`Symbol(${C})`}if(A=="function"){const C=g.name;return typeof C=="string"&&C.length>0?`Function(${C})`:"Function"}if(Array.isArray(g)){const C=g.length;let D="[";C>0&&(D+=pI(g[0]));for(let G=1;G<C;G++)D+=", "+pI(g[G]);return D+="]",D}const I=/\[object ([^\]]+)\]/.exec(toString.call(g));let Q;if(I&&I.length>1)Q=I[1];else return toString.call(g);if(Q=="Object")try{return"Object("+JSON.stringify(g)+")"}catch{return"Object"}return g instanceof Error?`${g.name}: ${g.message}
${g.stack}`:Q}function bg(g,A){const I=$(g,E.__wbindgen_malloc,E.__wbindgen_realloc),Q=K;return E.fetch_js(I,Q,A)}function Pg(g,A){const I=$(g,E.__wbindgen_malloc,E.__wbindgen_realloc),Q=K;return E.fetch_stream_js(I,Q,A)}let WA=null;function jg(){return(WA===null||WA.buffer!==E.memory.buffer)&&(WA=new Float32Array(E.memory.buffer)),WA}function nA(g,A){return g=g>>>0,jg().subarray(g/4,g/4+A)}function fg(g,A){g=g>>>0;const I=q(),Q=[];for(let C=g;C<g+4*A;C+=4)Q.push(E.__wbindgen_export_1.get(I.getUint32(C,!0)));return E.__externref_drop_slice(g,A),Q}function ig(){E.init_console_error()}function wg(){return E.get_bytes_per_covariance()}function Gg(){return E.get_bytes_per_color()}function og(){return E.get_bytes_per_covariance()}function BI(){return E.is_position_f16()!==0}function Ng(g,A,I){const Q=$(g,E.__wbindgen_malloc,E.__wbindgen_realloc),C=K;return E.load_url(Q,C,A,j(I)?0:m(I))}function mg(g,A){if(!(g instanceof A))throw new Error(`expected instance of ${A.name}`)}function rg(g,A){const I=A(g.length*1,1)>>>0;return OA().set(g,I/1),K=g.length,I}let bA=null;function Fg(){return(bA===null||bA.buffer!==E.memory.buffer)&&(bA=new Uint32Array(E.memory.buffer)),bA}function zg(g,A){const I=A(g.length*4,4)>>>0;return Fg().set(g,I/4),K=g.length,I}function eg(g,A){return g=g>>>0,Fg().subarray(g/4,g/4+A)}function Rg(g){return E.initThreadPool(g)}function ug(g){E.wbg_rayon_start_worker(g)}function vg(g,A,I){E.closure92_externref_shim(g,A,I)}function Ug(g,A,I){E.closure1014_externref_shim(g,A,I)}function _g(g,A,I,Q){E.closure1035_externref_shim(g,A,I,Q)}const kg=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(g=>E.__wbg_hit_free(g>>>0,1));class oI{static __wrap(A){A=A>>>0;const I=Object.create(oI.prototype);return I.__wbg_ptr=A,kg.register(I,I.__wbg_ptr,I),I}__destroy_into_raw(){const A=this.__wbg_ptr;return this.__wbg_ptr=0,kg.unregister(this),A}free(){const A=this.__destroy_into_raw();E.__wbg_hit_free(A,0)}get point(){const A=E.__wbg_get_hit_point(this.__wbg_ptr);return mA.__wrap(A)}set point(A){mg(A,mA);var I=A.__destroy_into_raw();E.__wbg_set_hit_point(this.__wbg_ptr,I)}get distance(){return E.__wbg_get_hit_distance(this.__wbg_ptr)}set distance(A){E.__wbg_set_hit_distance(this.__wbg_ptr,A)}get index(){return E.__wbg_get_hit_index(this.__wbg_ptr)>>>0}set index(A){E.__wbg_set_hit_index(this.__wbg_ptr,A)}}const yg=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(g=>E.__wbg_point_free(g>>>0,1));class mA{static __wrap(A){A=A>>>0;const I=Object.create(mA.prototype);return I.__wbg_ptr=A,yg.register(I,I.__wbg_ptr,I),I}__destroy_into_raw(){const A=this.__wbg_ptr;return this.__wbg_ptr=0,yg.unregister(this),A}free(){const A=this.__destroy_into_raw();E.__wbg_point_free(A,0)}get x(){return E.__wbg_get_point_x(this.__wbg_ptr)}set x(A){E.__wbg_set_point_x(this.__wbg_ptr,A)}get y(){return E.__wbg_get_point_y(this.__wbg_ptr)}set y(A){E.__wbg_set_point_y(this.__wbg_ptr,A)}get z(){return E.__wbg_get_point_z(this.__wbg_ptr)}set z(A){E.__wbg_set_point_z(this.__wbg_ptr,A)}}const Mg=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(g=>E.__wbg_sortdata_free(g>>>0,1));class Jg{__destroy_into_raw(){const A=this.__wbg_ptr;return this.__wbg_ptr=0,Mg.unregister(this),A}free(){const A=this.__destroy_into_raw();E.__wbg_sortdata_free(A,0)}get splat_count(){return E.__wbg_get_sortdata_splat_count(this.__wbg_ptr)>>>0}set splat_count(A){E.__wbg_set_sortdata_splat_count(this.__wbg_ptr,A)}get use_shared_memory(){return E.__wbg_get_sortdata_use_shared_memory(this.__wbg_ptr)!==0}set use_shared_memory(A){E.__wbg_set_sortdata_use_shared_memory(this.__wbg_ptr,A)}get dynamic_mode(){return E.__wbg_get_sortdata_dynamic_mode(this.__wbg_ptr)!==0}set dynamic_mode(A){E.__wbg_set_sortdata_dynamic_mode(this.__wbg_ptr,A)}constructor(A,I,Q,C){const D=E.sortdata_new(A,I,Q,C);return this.__wbg_ptr=D>>>0,Mg.register(this,this.__wbg_ptr,this),this}setPositions(A,I,Q){const C=rg(A,E.__wbindgen_malloc),D=K;E.sortdata_setPositions(this.__wbg_ptr,C,D,I,Q)}setBounds(A,I){E.sortdata_setBounds(this.__wbg_ptr,A,I)}setTransformIndices(A){const I=zg(A,E.__wbindgen_malloc),Q=K;E.sortdata_setTransformIndices(this.__wbg_ptr,I,Q)}setTransforms(A){const I=Cg(A,E.__wbindgen_malloc),Q=K;E.sortdata_setTransforms(this.__wbg_ptr,I,Q)}setTransform(A,I){E.sortdata_setTransform(this.__wbg_ptr,A,I)}getSortedIndices(){const A=E.sortdata_getSortedIndices(this.__wbg_ptr);var I=eg(A[0],A[1]).slice();return E.__wbindgen_free(A[0],A[1]*4,4),I}getSortedIndicesPtr(){return E.sortdata_getSortedIndicesPtr(this.__wbg_ptr)>>>0}sort(A,I){return E.sortdata_sort(this.__wbg_ptr,A,I)>>>0}}const hg=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(g=>E.__wbg_splatbuffer_free(g>>>0,1));class NI{static __wrap(A){A=A>>>0;const I=Object.create(NI.prototype);return I.__wbg_ptr=A,hg.register(I,I.__wbg_ptr,I),I}__destroy_into_raw(){const A=this.__wbg_ptr;return this.__wbg_ptr=0,hg.unregister(this),A}free(){const A=this.__destroy_into_raw();E.__wbg_splatbuffer_free(A,0)}setTransform(A){E.splatbuffer_setTransform(this.__wbg_ptr,j(A)?0:m(A))}getMetadata(){let A,I;try{const Q=E.splatbuffer_getMetadata(this.__wbg_ptr);return A=Q[0],I=Q[1],r(Q[0],Q[1])}finally{E.__wbindgen_free(A,I,1)}}getTransform(){const A=E.splatbuffer_getTransform(this.__wbg_ptr);let I;return A[0]!==0&&(I=nA(A[0],A[1]).slice(),E.__wbindgen_free(A[0],A[1]*4,4)),I}getGaussianCount(){return E.splatbuffer_getGaussianCount(this.__wbg_ptr)>>>0}getSHDegree(){return E.splatbuffer_getSHDegree(this.__wbg_ptr)}getSHCBCount(){return E.splatbuffer_getSHCBCount(this.__wbg_ptr)>>>0}getSceneCenter(){const A=E.splatbuffer_getSceneCenter(this.__wbg_ptr);var I=nA(A[0],A[1]).slice();return E.__wbindgen_free(A[0],A[1]*4,4),I}getCenterRadiusList(){const A=E.splatbuffer_getCenterRadiusList(this.__wbg_ptr);var I=nA(A[0],A[1]).slice();return E.__wbindgen_free(A[0],A[1]*4,4),I}getCenterRadiusStep(){return E.splatbuffer_getCenterRadiusStep(this.__wbg_ptr)>>>0}getCurrentRadius(){return E.splatbuffer_getCurrentRadius(this.__wbg_ptr)}getMaximumRadius(){return E.splatbuffer_getMaximumRadius(this.__wbg_ptr)}getBoundsMin(){const A=E.splatbuffer_getBoundsMin(this.__wbg_ptr);var I=nA(A[0],A[1]).slice();return E.__wbindgen_free(A[0],A[1]*4,4),I}getBoundsMax(){const A=E.splatbuffer_getBoundsMax(this.__wbg_ptr);var I=nA(A[0],A[1]).slice();return E.__wbindgen_free(A[0],A[1]*4,4),I}getPositionsBufferPtr(){return E.splatbuffer_getPositionsBufferPtr(this.__wbg_ptr)>>>0}getCovariancesBufferPtr(){return E.splatbuffer_getCovariancesBufferPtr(this.__wbg_ptr)>>>0}getColorsBufferPtr(){return E.splatbuffer_getColorsBufferPtr(this.__wbg_ptr)>>>0}getShCoeffsBufferPtr(){const A=E.splatbuffer_getShCoeffsBufferPtr(this.__wbg_ptr);return A===4294967297?void 0:A}getShCoeffsIndicesBufferPtr(){const A=E.splatbuffer_getShCoeffsIndicesBufferPtr(this.__wbg_ptr);return A===4294967297?void 0:A}getShCoeffsCBBufferPtr(){const A=E.splatbuffer_getShCoeffsCBBufferPtr(this.__wbg_ptr);return A===4294967297?void 0:A}getLoadedPositionsCount(){return E.splatbuffer_getLoadedPositionsCount(this.__wbg_ptr)>>>0}getLoadedColorsCount(){return E.splatbuffer_getLoadedColorsCount(this.__wbg_ptr)>>>0}getLoadedShCoeffsCount(){return E.splatbuffer_getLoadedShCoeffsCount(this.__wbg_ptr)>>>0}getLoadedShCoeffsIndicesCount(){return E.splatbuffer_getLoadedShCoeffsIndicesCount(this.__wbg_ptr)>>>0}getLoadedShCoeffsCBCount(){return E.splatbuffer_getLoadedShCoeffsCBCount(this.__wbg_ptr)>>>0}getLoadedCovariancesCount(){return E.splatbuffer_getLoadedCovariancesCount(this.__wbg_ptr)>>>0}getDistanceLoadedFromSceneCenter(){return E.splatbuffer_getDistanceLoadedFromSceneCenter(this.__wbg_ptr)}computeVisibleIndices(A,I,Q){return E.splatbuffer_computeVisibleIndices(this.__wbg_ptr,A,I,Q)>>>0}getVisibleIndicesBufferPtr(){return E.splatbuffer_getVisibleIndicesBufferPtr(this.__wbg_ptr)>>>0}raycast(A,I,Q,C){const D=E.splatbuffer_raycast(this.__wbg_ptr,A,I,Q,C);var G=fg(D[0],D[1]).slice();return E.__wbindgen_free(D[0],D[1]*4,4),G}getOctree(){return E.splatbuffer_getOctree(this.__wbg_ptr)}}const cg=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(g=>E.__wbg_wbg_rayon_poolbuilder_free(g>>>0,1));class FI{static __wrap(A){A=A>>>0;const I=Object.create(FI.prototype);return I.__wbg_ptr=A,cg.register(I,I.__wbg_ptr,I),I}__destroy_into_raw(){const A=this.__wbg_ptr;return this.__wbg_ptr=0,cg.unregister(this),A}free(){const A=this.__destroy_into_raw();E.__wbg_wbg_rayon_poolbuilder_free(A,0)}numThreads(){return E.wbg_rayon_poolbuilder_numThreads(this.__wbg_ptr)>>>0}receiver(){return E.wbg_rayon_poolbuilder_receiver(this.__wbg_ptr)>>>0}build(){E.wbg_rayon_poolbuilder_build(this.__wbg_ptr)}}async function $g(g,A){if(typeof Response=="function"&&g instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(g,A)}catch(Q){if(g.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",Q);else throw Q}const I=await g.arrayBuffer();return await WebAssembly.instantiate(I,A)}else{const I=await WebAssembly.instantiate(g,A);return I instanceof WebAssembly.Instance?{instance:I,module:g}:I}}function Sg(){const g={};return g.wbg={},g.wbg.__wbg_Window_925630dd9364b9e7=function(A){return A.Window},g.wbg.__wbg_WorkerGlobalScope_f8a15b453de109c0=function(A){return A.WorkerGlobalScope},g.wbg.__wbg_async_9ff6d9e405f13772=function(A){return A.async},g.wbg.__wbg_body_0b8fd1fe671660df=function(A){const I=A.body;return j(I)?0:m(I)},g.wbg.__wbg_buffer_609cc3eee51ed158=function(A){return A.buffer},g.wbg.__wbg_call_672a4d21634d4a24=function(){return H(function(A,I){return A.call(I)},arguments)},g.wbg.__wbg_call_7cccdd69e0791ae2=function(){return H(function(A,I,Q){return A.call(I,Q)},arguments)},g.wbg.__wbg_call_833bed5770ea2041=function(){return H(function(A,I,Q,C){return A.call(I,Q,C)},arguments)},g.wbg.__wbg_call_b8adc8b1d0a0d8eb=function(){return H(function(A,I,Q,C,D){return A.call(I,Q,C,D)},arguments)},g.wbg.__wbg_data_432d9c3df2630942=function(A){return A.data},g.wbg.__wbg_elements_a81bc7dfdce748ad=function(A,I){const Q=I.elements,C=Cg(Q,E.__wbindgen_malloc),D=K;q().setInt32(A+4*1,D,!0),q().setInt32(A+4*0,C,!0)},g.wbg.__wbg_error_7534b8e9a36f1ab4=function(A,I){let Q,C;try{Q=A,C=I,console.error(r(A,I))}finally{E.__wbindgen_free(Q,C,1)}},g.wbg.__wbg_fetch_509096533071c657=function(A,I){return A.fetch(I)},g.wbg.__wbg_fetch_b7bf320f681242d2=function(A,I){return A.fetch(I)},g.wbg.__wbg_getRandomValues_80578b2ff2a093ba=function(){return H(function(A){globalThis.crypto.getRandomValues(A)},arguments)},g.wbg.__wbg_getReader_be0d36e5873a525b=function(A){return A.getReader()},g.wbg.__wbg_get_123509460060ab98=function(){return H(function(A,I,Q,C){const D=I.get(r(Q,C));var G=j(D)?0:$(D,E.__wbindgen_malloc,E.__wbindgen_realloc),N=K;q().setInt32(A+4*1,N,!0),q().setInt32(A+4*0,G,!0)},arguments)},g.wbg.__wbg_get_67b2ba62fc30de12=function(){return H(function(A,I){return Reflect.get(A,I)},arguments)},g.wbg.__wbg_headers_9cb51cfd2ac780a4=function(A){return A.headers},g.wbg.__wbg_hit_new=function(A){return oI.__wrap(A)},g.wbg.__wbg_instanceof_File_a4e2256bf71955a9=function(A){let I;try{I=A instanceof File}catch{I=!1}return I},g.wbg.__wbg_instanceof_Object_7f2dcef8f78644a4=function(A){let I;try{I=A instanceof Object}catch{I=!1}return I},g.wbg.__wbg_instanceof_Response_f2cc20d9f7dfd644=function(A){let I;try{I=A instanceof Response}catch{I=!1}return I},g.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(A){let I;try{I=A instanceof Uint8Array}catch{I=!1}return I},g.wbg.__wbg_instanceof_Window_def73ea0955fc569=function(A){let I;try{I=A instanceof Window}catch{I=!1}return I},g.wbg.__wbg_length_a446193dc22c12f8=function(A){return A.length},g.wbg.__wbg_new_23a2665fac83c611=function(A,I){try{var Q={a:A,b:I},C=(G,N)=>{const R=Q.a;Q.a=0;try{return _g(R,Q.b,G,N)}finally{Q.a=R}};return new Promise(C)}finally{Q.a=Q.b=0}},g.wbg.__wbg_new_405e22f390576ce2=function(){return new Object},g.wbg.__wbg_new_46e8134c3341d05a=function(){return H(function(){return new FileReader},arguments)},g.wbg.__wbg_new_78feb108b6472713=function(){return new Array},g.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},g.wbg.__wbg_new_9ffbe0a71eff35e3=function(){return H(function(A,I){return new URL(r(A,I))},arguments)},g.wbg.__wbg_new_a12002a7f91c75be=function(A){return new Uint8Array(A)},g.wbg.__wbg_new_b1a33e5095abf678=function(){return H(function(A,I){return new Worker(r(A,I))},arguments)},g.wbg.__wbg_new_e25e5aab09ff45db=function(){return H(function(){return new AbortController},arguments)},g.wbg.__wbg_new_e9a4a67dbababe57=function(A){return new Int32Array(A)},g.wbg.__wbg_newnoargs_105ed471475aaf50=function(A,I){return new Function(r(A,I))},g.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(A,I,Q){return new Uint8Array(A,I>>>0,Q>>>0)},g.wbg.__wbg_newwithlength_a381634e90c276d4=function(A){return new Uint8Array(A>>>0)},g.wbg.__wbg_newwithstrandinit_06c535e0a867c635=function(){return H(function(A,I,Q){return new Request(r(A,I),Q)},arguments)},g.wbg.__wbg_of_4a05197bfc89556f=function(A,I,Q){return Array.of(A,I,Q)},g.wbg.__wbg_pathname_9b0b04c4e19316d0=function(A,I){const Q=I.pathname,C=$(Q,E.__wbindgen_malloc,E.__wbindgen_realloc),D=K;q().setInt32(A+4*1,D,!0),q().setInt32(A+4*0,C,!0)},g.wbg.__wbg_postMessage_6edafa8f7b9c2f52=function(){return H(function(A,I){A.postMessage(I)},arguments)},g.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5=function(A){queueMicrotask(A)},g.wbg.__wbg_queueMicrotask_d3219def82552485=function(A){return A.queueMicrotask},g.wbg.__wbg_readAsArrayBuffer_e51cb3c4fcc962de=function(){return H(function(A,I){A.readAsArrayBuffer(I)},arguments)},g.wbg.__wbg_read_a2434af1186cb56c=function(A){return A.read()},g.wbg.__wbg_resolve_4851785c9c5f573d=function(A){return Promise.resolve(A)},g.wbg.__wbg_result_dadbdcc801180072=function(){return H(function(A){return A.result},arguments)},g.wbg.__wbg_set_37837023f3d740e8=function(A,I,Q){A[I>>>0]=Q},g.wbg.__wbg_set_3f1d0b984ed272ed=function(A,I,Q){A[I]=Q},g.wbg.__wbg_set_65595bdd868b3009=function(A,I,Q){A.set(I,Q>>>0)},g.wbg.__wbg_setonerror_578ff66d3363c119=function(A,I){A.onerror=I},g.wbg.__wbg_setonload_1302417ca59f658b=function(A,I){A.onload=I},g.wbg.__wbg_setonmessage_5a885b16bdc6dca6=function(A,I){A.onmessage=I},g.wbg.__wbg_setsignal_75b21ef3a81de905=function(A,I){A.signal=I},g.wbg.__wbg_signal_aaf9ad74119f20a4=function(A){return A.signal},g.wbg.__wbg_size_3808d41635a9c259=function(A){return A.size},g.wbg.__wbg_slice_bd4c84b64bdfe01f=function(){return H(function(A,I,Q){return A.slice(I,Q)},arguments)},g.wbg.__wbg_splatbuffer_new=function(A){return NI.__wrap(A)},g.wbg.__wbg_stack_0ed75d68575b0f3c=function(A,I){const Q=I.stack,C=$(Q,E.__wbindgen_malloc,E.__wbindgen_realloc),D=K;q().setInt32(A+4*1,D,!0),q().setInt32(A+4*0,C,!0)},g.wbg.__wbg_startWorkers_2ca11761e08ff5d5=function(A,I,Q){return Wg(A,I,FI.__wrap(Q))},g.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const A=typeof global>"u"?null:global;return j(A)?0:m(A)},g.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const A=typeof globalThis>"u"?null:globalThis;return j(A)?0:m(A)},g.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const A=typeof self>"u"?null:self;return j(A)?0:m(A)},g.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const A=typeof window>"u"?null:window;return j(A)?0:m(A)},g.wbg.__wbg_status_f6360336ca686bf0=function(A){return A.status},g.wbg.__wbg_subarray_aa9065fa9dc5df96=function(A,I,Q){return A.subarray(I>>>0,Q>>>0)},g.wbg.__wbg_then_44b73946d2fb3e7d=function(A,I){return A.then(I)},g.wbg.__wbg_then_48b406749878a531=function(A,I,Q){return A.then(I,Q)},g.wbg.__wbg_value_dab73d3d5d4abaaf=function(A){return A.value},g.wbg.__wbg_waitAsync_61f0a081053dd3c2=function(A,I,Q){return Atomics.waitAsync(A,I>>>0,Q)},g.wbg.__wbg_waitAsync_7ce6c8a047c752c3=function(){return Atomics.waitAsync},g.wbg.__wbg_x_ee17d5da172d082f=function(A){return A.x},g.wbg.__wbg_y_74842f81d209bef6=function(A){return A.y},g.wbg.__wbg_z_a3f29b8ed2d03d80=function(A){return A.z},g.wbg.__wbindgen_boolean_get=function(A){const I=A;return typeof I=="boolean"?I?1:0:2},g.wbg.__wbindgen_cb_drop=function(A){const I=A.original;return I.cnt--==1?(I.a=0,!0):!1},g.wbg.__wbindgen_closure_wrapper267=function(A,I,Q){return TI(A,I,93,vg)},g.wbg.__wbindgen_closure_wrapper2904=function(A,I,Q){return TI(A,I,1015,Ug)},g.wbg.__wbindgen_closure_wrapper2905=function(A,I,Q){return TI(A,I,1015,Ug)},g.wbg.__wbindgen_debug_string=function(A,I){const Q=pI(I),C=$(Q,E.__wbindgen_malloc,E.__wbindgen_realloc),D=K;q().setInt32(A+4*1,D,!0),q().setInt32(A+4*0,C,!0)},g.wbg.__wbindgen_init_externref_table=function(){const A=E.__wbindgen_export_1,I=A.grow(4);A.set(0,void 0),A.set(I+0,void 0),A.set(I+1,null),A.set(I+2,!0),A.set(I+3,!1)},g.wbg.__wbindgen_is_function=function(A){return typeof A=="function"},g.wbg.__wbindgen_is_undefined=function(A){return A===void 0},g.wbg.__wbindgen_link_9579f016b4522a24=function(A){const I=`onmessage = function (ev) {
            let [ia, index, value] = ev.data;
            ia = new Int32Array(ia.buffer);
            let result = Atomics.wait(ia, index, value);
            postMessage(result);
        };
        `,Q=typeof URL.createObjectURL>"u"?"data:application/javascript,"+encodeURIComponent(I):URL.createObjectURL(new Blob([I],{type:"text/javascript"})),C=$(Q,E.__wbindgen_malloc,E.__wbindgen_realloc),D=K;q().setInt32(A+4*1,D,!0),q().setInt32(A+4*0,C,!0)},g.wbg.__wbindgen_memory=function(){return E.memory},g.wbg.__wbindgen_module=function(){return EI.__wbindgen_wasm_module},g.wbg.__wbindgen_number_get=function(A,I){const Q=I,C=typeof Q=="number"?Q:void 0;q().setFloat64(A+8*1,j(C)?0:C,!0),q().setInt32(A+4*0,!j(C),!0)},g.wbg.__wbindgen_number_new=function(A){return A},g.wbg.__wbindgen_rethrow=function(A){throw A},g.wbg.__wbindgen_string_new=function(A,I){return r(A,I)},g.wbg.__wbindgen_throw=function(A,I){throw new Error(r(A,I))},g}function Yg(g,A){g.wbg.memory=A||new WebAssembly.Memory({initial:23,maximum:65536,shared:!0})}function sg(g,A,I){if(E=g.exports,EI.__wbindgen_wasm_module=A,lA=null,WA=null,bA=null,XA=null,typeof I<"u"&&(typeof I!="number"||I===0||I%65536!==0))throw"invalid stack size";return E.__wbindgen_start(I),E}function AQ(g,A){if(E!==void 0)return E;let I;typeof g<"u"&&(Object.getPrototypeOf(g)===Object.prototype?{module:g,memory:A,thread_stack_size:I}=g:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const Q=Sg();Yg(Q,A),g instanceof WebAssembly.Module||(g=new WebAssembly.Module(g));const C=new WebAssembly.Instance(g,Q);return sg(C,g,I)}async function EI(g,A){if(E!==void 0)return E;let I;typeof g<"u"&&(Object.getPrototypeOf(g)===Object.prototype?{module_or_path:g,memory:A,thread_stack_size:I}=g:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof g>"u"&&(g=new URL("./tdvgs/gslib_bg.wasm",import.meta.url));const Q=Sg();(typeof g=="string"||typeof Request=="function"&&g instanceof Request||typeof URL=="function"&&g instanceof URL)&&(g=fetch(g)),Yg(Q,A);const{instance:C,module:D}=await $g(await g,Q);return sg(C,D,I)}const IQ=Object.freeze(Object.defineProperty({__proto__:null,Hit:oI,Point:mA,SortData:Jg,SplatBuffer:NI,default:EI,fetch_js:bg,fetch_stream_js:Pg,get_bytes_per_color:Gg,get_bytes_per_covariance:og,get_bytes_per_position:wg,initSync:AQ,initThreadPool:Rg,init_console_error:ig,is_position_f16:BI,load_url:Ng,wbg_rayon_PoolBuilder:FI,wbg_rayon_start_worker:ug},Symbol.toStringTag,{value:"Module"})),gQ=()=>(async g=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(g)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),QQ=function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)},CQ=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},Lg=function(){return/\sVR\s|OculusBrowser|PicoBrowser/i.test(navigator.userAgent)};let DI=!1,ZI;async function ag(g){DI||(DI=!0,ZI=(await EI(void 0,QQ()||Lg()?new WebAssembly.Memory({initial:23,maximum:8192,shared:!0}):void 0)).memory,ig(),g>1&&!CQ()&&!Lg()&&await gQ()&&await Rg(g))}function BQ(){DI&&(ZI=void 0,DI=!1)}function SA(){return ZI}let p;var z=(g=>(g[g.Init=0]="Init",g[g.Positions=1]="Positions",g[g.Bounds=2]="Bounds",g[g.Sort=3]="Sort",g[g.Dispose=4]="Dispose",g))(z||{});onmessage=async function(g){const A=g.data;if(A&&A.method!==void 0){if(A.method!=0&&!p)return;switch(A.method){case 0:await ag(1);const I=A.payload;EQ(I),postMessage({method:A.method});break;case 1:const Q=A.payload;postMessage({method:A.method,payload:iQ(Q)});break;case 2:const C=A.payload;postMessage({method:A.method,payload:wQ(C)});break;case 3:const D=A.payload;postMessage({method:A.method,payload:GQ(D)});break;case 4:DQ();break;default:console.error("Unknown method:",A.method);break}}};function EQ(g){p&&p.free(),p=new Jg(g.splatCount,g.dynamicMode,g.useSharedMemory,g.maxScenes)}function DQ(){p&&(p.free(),p=void 0),BQ()}function iQ(g){return p.setPositions(new Uint8Array(g.positions.buffer),g.offset,g.halfPrecision),{offset:g.offset,length:g.positions.length/3}}function wQ(g){return p.setBounds(g.min,g.max),{}}function GQ(g){let A=performance.now(),I=p.sort(g.cameraPos,g.cameraDir);return{sortedIndices:p.use_shared_memory?new Uint32Array(SA().buffer,p.getSortedIndicesPtr(),I):new Uint32Array(p.getSortedIndices().buffer,0,I),renderCount:I,time:performance.now()-A}}function oQ(g){return new Worker(""+new URL("tdvgs/worker1.js",import.meta.url).href,{type:"module",name:g?.name})}class iI{}c(iI,"MaxScenes",32);const Kg={type:"change"},Hg=class GI extends w.EventDispatcher{constructor(){if(B(GI,sA)!==void 0)return B(GI,sA);super(),c(this,"ui"),c(this,"stats"),i(GI,sA,this)}async activate(A){if(!this.isActive()){try{const I=await import("lil-gui");this.ui=new I.GUI({closeFolders:!0}),this.ui.close()}catch{console.error("lil-gui not found");return}try{const I=(await import("stats-gl")).default;this.stats=new I({trackGPU:!0}),document.body.appendChild(this.stats.dom),await this.stats.init(A)}catch{console.error("stats-gl not found");return}this.dispatchEvent(Kg)}}dispose(){this.isActive()&&(this.ui&&(this.ui.destroy(),this.ui=void 0),this.stats&&(this.stats.dom.remove(),this.stats=void 0),this.dispatchEvent(Kg))}isActive(){return this.ui!==void 0}};sA=new WeakMap,o(Hg,sA);let lI=Hg;var XI=(g=>(g.INIT="init",g.READY="ready",g))(XI||{});class NQ extends w.EventDispatcher{constructor(A,I){super(),o(this,hI),c(this,"lastSortTime",0),c(this,"maxSortTime",0),o(this,iA,!1),o(this,LA),o(this,rA),o(this,l),o(this,wA,!1),o(this,MI,0),o(this,JI,new lI),o(this,aA,!1),o(this,zA,1),o(this,cI,Q=>{switch(Q.data.method){case z.Init:i(this,iA,!0),this.dispatchEvent({type:"init"});break;case z.Positions:const C=Q.data.payload;i(this,MI,C.offset+C.length),i(this,aA,!0);break;case z.Sort:const D=Q.data.payload;i(this,wA,!1),this.lastSortTime=D.time,B(this,JI).isActive()&&(this.maxSortTime=Math.max(this.maxSortTime,this.lastSortTime)),this.dispatchEvent({type:"ready",data:{indices:D.sortedIndices,renderCount:D.renderCount}});break}}),c(this,"update",(()=>{const Q=new w.Vector3,C=new w.Vector3,D=new w.Vector3,G=new w.Vector3,N=new w.Vector3;return R=>{if(B(this,wA)||!B(this,iA))return;let M,Y,V=!1,d=!1;G.setFromMatrixPosition(R);let t=R.elements;if(D.set(t[8],t[9],t[10]).negate().normalize(),M=D.dot(Q),Y=N.copy(G).sub(C).length(),!B(this,aA)&&!B(this,LA)&&(M<=.99&&(V=!0),Y>=B(this,zA)&&(d=!0),!V&&!d))return;i(this,wA,!0);const Z={cameraPos:G,cameraDir:D};B(this,l).postMessage({method:z.Sort,payload:Z}),C.copy(G),Q.copy(D),i(this,aA,!1)}})()),i(this,LA,A),i(this,rA,I)}dispose(){B(this,iA)&&(B(this,l)&&(B(this,l).postMessage({method:z.Dispose}),B(this,l).terminate(),i(this,l,void 0)),i(this,wA,!1),i(this,iA,!1))}init(A){this.dispose(),U(this,hI,bI).call(this);const I={splatCount:A,useSharedMemory:B(this,rA),dynamicMode:B(this,LA),maxScenes:iI.MaxScenes};B(this,l).postMessage({method:z.Init,payload:I})}addPositions(A,I,Q){const C={positions:A,offset:I,halfPrecision:Q};B(this,l).postMessage({method:z.Positions,payload:C})}setBounds(A,I){var Q;i(this,zA,Math.min(1,I.distanceTo(A)*.001));const C={min:A,max:I};(Q=B(this,l))==null||Q.postMessage({method:z.Bounds,payload:C})}}iA=new WeakMap,LA=new WeakMap,rA=new WeakMap,l=new WeakMap,wA=new WeakMap,MI=new WeakMap,JI=new WeakMap,aA=new WeakMap,zA=new WeakMap,hI=new WeakSet,bI=function(){i(this,l,new oQ),B(this,l).onmessage=B(this,cI).bind(this)},cI=new WeakMap;const FQ="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0O3ByZWNpc2lvbiBoaWdocCBpbnQ7cHJlY2lzaW9uIGhpZ2hwIHNhbXBsZXIyRDtwcmVjaXNpb24gaGlnaHAgdXNhbXBsZXIyRDsKI2RlZmluZSB2YXJ5aW5nIG91dAp1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4LHByb2plY3Rpb25NYXRyaXg7aW4gdmVjMiBwb3NpdGlvbjtpbiBpbnQgdjt1bmlmb3JtIGhpZ2hwIHVzYW1wbGVyMkQgUzsKI2lmZGVmIFNUCnVuaWZvcm0gbG93cCB1c2FtcGxlcjJEIHg7Y29uc3QgdmVjNCBoPXZlYzQoMSwuODcsMCwuOSkscj12ZWM0KDAsLjYyMzUsLjg5MDIsLjcpOwojZW5kaWYKI2lmZGVmIERNCnVuaWZvcm0gaGlnaHAgdXNhbXBsZXIyRCB5O3VuaWZvcm0gaGlnaHAgbWF0NCBtW01BWF9TQ0VORVNdOwojZW5kaWYKI2lmZGVmIENPVkFBCnVuaWZvcm0gZmxvYXQgdTsKI2VuZGlmCnVuaWZvcm0gZmxvYXQgejt1bmlmb3JtIHZlYzIgdCx3O3VuaWZvcm0gdmVjMyBmOwojaWZkZWYgUkZJQQp1bmlmb3JtIHZlYzMgbjt1bmlmb3JtIHZlYzIgaSxwLEQ7CiNlbmRpZgp2YXJ5aW5nIHZlYzQgdkNvbG9yO3ZhcnlpbmcgdmVjMiB2UG9zaXRpb247dmFyeWluZyBmbG9hdCB2RGVwdGg7CiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+CmNvbnN0IGZsb2F0IEM9MS4vMjU1Ljtjb25zdCB1dmVjNCBzPXV2ZWM0KDQyNzgxOTAwODAsMTY3MTE2ODAsNjUyODAsMjU1KSxjPXV2ZWM0KDI0LDE2LDgsMCk7dmVjNCB1aW50VG9SR0JBVmVjKHVpbnQgdil7dXZlYzQgdT1zJnY7dT4+PWM7cmV0dXJuIHZlYzQodSkqQzt9CiNpZmRlZiBTSAojaWZkZWYgU0hDQjE2CnVuaWZvcm0gbWVkaXVtcCBzYW1wbGVyMkQgUjttZWRpdW1wIHZlYzMgZShpdmVjMiB2LGludCBTLGludCB1KXtyZXR1cm4gdGV4ZWxGZXRjaChSLHYraXZlYzIoUyx1KSwwKS54eXo7fW1lZGl1bXAgdmVjMyBlKHZlYzMgdSx1aW50IHYpe2l2ZWMyIFM9aXZlYzIoaW50KHYmMjU1dSksaW50KHY+Pjh1KSkqNDsKI2lmZGVmIFNIMQpmbG9hdCBtPXUueCx4PXUueSx5PXUuejttZWRpdW1wIHZlYzMgej0uNDg4NjAyNSooLXgqZShTLDAsMCkreSplKFMsMSwwKS1tKmUoUywyLDApKTsKI2lmZGVmIFNIMgpmbG9hdCBoPW0qbSxpPXgqeCxyPXkqeSx3PW0qeDt6Kz0xLjA5MjU0ODQqdyplKFMsMywwKS14KnkqMS4wOTI1NDg0KmUoUywwLDEpKy4zMTUzOTE2KigyLipyLWgtaSkqZShTLDEsMSktbSp5KjEuMDkyNTQ4NCplKFMsMiwxKSsuNTQ2Mjc0MiooaC1pKSplKFMsMywxKTsKI2lmZGVmIFNIMwp6Kz0tLjU5MDA0MzYqeCooMy4qaC1pKSplKFMsMCwyKSsyLjg5MDYxMTQqdyp5KmUoUywxLDIpLS40NTcwNDU3KngqKDQuKnItaC1pKSplKFMsMiwyKSsuMzczMTc2Myp5KigyLipyLTMuKmgtMy4qaSkqZShTLDMsMiktLjQ1NzA0NTgqbSooNC4qci1oLWkpKmUoUywwLDMpKzEuNDQ1MzA1Nyp5KihoLWkpKmUoUywxLDMpLS41OTAwNDM2Km0qKGgtMy4qaSkqZShTLDIsMyk7CiNlbmRpZgoKI2VuZGlmCnJldHVybiB6OwojZW5kaWYKcmV0dXJuIHZlYzMoMCk7fQojZWxzZQp1bmlmb3JtIGhpZ2hwIHVzYW1wbGVyMkQgSCxBLEI7bWVkaXVtcCB2ZWMzIGUodmVjMyB1KXtpdmVjMiBTPWl2ZWMyKHYmVFdPVFBTX1NILHY+PkVUV09UUFNfU0gpOwojaWZkZWYgU0gxCmZsb2F0IG09dS54LHg9dS55LHk9dS56O3V2ZWM0IGg9dGV4ZWxGZXRjaChILFMsMCk7dmVjNCByPXVpbnRUb1JHQkFWZWMoaC54KSoyLi0xLixpPXVpbnRUb1JHQkFWZWMoaC55KSoyLi0xLixlPXVpbnRUb1JHQkFWZWMoaC56KSoyLi0xLjttZWRpdW1wIHZlYzMgej0uNDg4NjAyNSooLXgqci54eXoreSp2ZWMzKHIudyxpKS1tKnZlYzMoaS56dyxlLngpKTsKI2lmZGVmIFNIMgpmbG9hdCBmPW0qbSx3PXgqeCxuPXkqeSxjPW0qeDt2ZWM0IEM9dWludFRvUkdCQVZlYyhoLncpKjIuLTEuO3V2ZWM0IEQ9dGV4ZWxGZXRjaChBLFMsMCk7dmVjNCBwPXVpbnRUb1JHQkFWZWMoRC54KSoyLi0xLixSPXVpbnRUb1JHQkFWZWMoRC55KSoyLi0xLixUPXVpbnRUb1JHQkFWZWMoRC56KSoyLi0xLjt6Kz0xLjA5MjU0ODQqYyplLnl6dy14KnkqMS4wOTI1NDg0KkMueHl6Ky4zMTUzOTE2KigyLipuLWYtdykqcC54eXotbSp5KjEuMDkyNTQ4NCp2ZWMzKHAudyxSKSsuNTQ2Mjc0MiooZi13KSp2ZWMzKFIuencsVC54KTsKI2lmZGVmIFNIMwp2ZWM0IHM9dWludFRvUkdCQVZlYyhELncpKjIuLTEuO3V2ZWM0IHQ9dGV4ZWxGZXRjaChCLFMsMCk7dmVjNCBOPXVpbnRUb1JHQkFWZWModC54KSoyLi0xLixFPXVpbnRUb1JHQkFWZWModC55KSoyLi0xLixGPXVpbnRUb1JHQkFWZWModC56KSoyLi0xLixHPXVpbnRUb1JHQkFWZWModC53KSoyLi0xLjt6Kz0tLjU5MDA0MzYqeCooMy4qZi13KSpULnl6dysyLjg5MDYxMTQqYyp5KnMueHl6LS40NTcwNDU3KngqKDQuKm4tZi13KSpOLnh5eisuMzczMTc2Myp5KigyLipuLTMuKmYtMy4qdykqdmVjMyhOLncsRSktLjQ1NzA0NTgqbSooNC4qbi1mLXcpKnZlYzMoRS56dyxGLngpKzEuNDQ1MzA1Nyp5KihmLXcpKkYueXp3LS41OTAwNDM2Km0qKGYtMy4qdykqRy54eXo7CiNlbmRpZgoKI2VuZGlmCnJldHVybiB6OwojZW5kaWYKcmV0dXJuIHZlYzMoMCk7fQojZW5kaWYKI2VuZGlmCnZvaWQgbWFpbigpewojaWZkZWYgU1QKbG93cCB1aW50IHo9dGV4ZWxGZXRjaCh4LGl2ZWMyKHYmVFdPVFBTLHY+PkVUV09UUFMpLDApLng7aWYoKHomMnUpIT0wdSl7Z2xfUG9zaXRpb249dmVjNCgwLDAsMiwxKTtyZXR1cm47fQojZW5kaWYKaW50IFI9KHYmVFdPVFBTKSpUUFMsRT12Pj5FVFdPVFBTO3V2ZWM0IEM9dGV4ZWxGZXRjaChTLGl2ZWMyKFIsRSksMCkueHl6dyxGPXRleGVsRmV0Y2goUyxpdmVjMihSKzEsRSksMCkueHl6dzsKI2lmZGVmIFBIRgp2ZWMzIHM9dmVjMyh1bnBhY2tIYWxmMngxNihDLngpLHVucGFja0hhbGYyeDE2KEMueSkueCk7CiNlbHNlCnZlYzMgSD11aW50Qml0c1RvRmxvYXQoQy54eXopOwojZW5kaWYKCiNpZmRlZiBETQp1aW50IE49dGV4ZWxGZXRjaCh5LGltZ0Nvb3JkcywwKS54O21hdDQgYz1tb2RlbFZpZXdNYXRyaXgqbVtOXTsKI2Vsc2UKbWF0NCBsPW1vZGVsVmlld01hdHJpeDsKI2VuZGlmCnZlYzQgVD1sKnZlYzQoSCwxKSxHPXByb2plY3Rpb25NYXRyaXgqVDtmbG9hdCBQPTEuMipHLnc7aWYoRy56PC1QfHxHLng8LVB8fEcueD5QfHxHLnk8LVB8fEcueT5QKXtnbF9Qb3NpdGlvbj12ZWM0KDAsMCwyLDEpO3JldHVybjt9dmVjMyBBPUcueHl6L0cudzt2RGVwdGg9KEEueisxLikqLjU7dkNvbG9yPXVpbnRUb1JHQkFWZWMoRi53KTt2ZWMyIEI9dW5wYWNrSGFsZjJ4MTYoRi54KSxJPXVucGFja0hhbGYyeDE2KEYueSksSj11bnBhY2tIYWxmMngxNihGLnopLEs9dC9ULnosTD0tSypULnh5L1QuejttYXQzIFU9dHJhbnNwb3NlKG1hdDMobCkpKm1hdDMoSy54LDAuLEwueCwwLixLLnksTC55LDAuLDAuLDAuKSxNPXRyYW5zcG9zZShVKSptYXQzKEIueCxCLnksSS54LEIueSxJLnksSi54LEkueCxKLngsSi55KSpVO2Zsb2F0IGc9TVswXVswXSxPPU1bMV1bMV0sUT1NWzBdWzFdOwojaWZkZWYgTkFBCmZsb2F0IG89ZypPLVEqUTtnKz0uMztPKz0uMztmbG9hdCBWPWcqTy1RKlE7dkNvbG9yLncqPXNxcnQobWF4KG8vViwwLikpOwojZWxzZQoKI2lmZGVmIENPVkFBCmcrPXU7Tys9dTsKI2Vsc2UKZys9LjM7Tys9LjM7CiNlbmRpZgoKI2VuZGlmCmZsb2F0IFc9KGcrTykqLjUsWD1sZW5ndGgodmVjMigoZy1PKSouNSxRKSksWT1XK1g7dmVjMiBaPW5vcm1hbGl6ZSh2ZWMyKFEsWS1nKSksXz1zcXJ0KDIuKnZlYzIoWSxtYXgoVy1YLC4xKSkpOwojaWZkZWYgUkZJQQpmbG9hdCBhPWxlbmd0aChILW4pO189bWl4KF8sdmVjMihSRklBX1NTKSwxLi1jbGFtcCgoRC54LWEpKkQueSwwLiwxLikpO3ZDb2xvci53Kj1jbGFtcCgoaS54LWEpKmkueSwwLiwxLikqY2xhbXAoKHAueC1hKSpwLnksMC4sMS4pOwojZW5kaWYKZmxvYXQgYj1jbGFtcCh2RGVwdGgqNS4sMC4sMS4pO18qPWI7dkNvbG9yLncqPWI7CiNpZmRlZiBTSAoKI2lmZGVmIFNIQ0IxNgp2Q29sb3IueHl6Kz1lKG5vcm1hbGl6ZShILWYpLEMudz4+MTZ1KTsKI2Vsc2UKdkNvbG9yLnh5eis9ZShub3JtYWxpemUoSC1mKSk7CiNlbmRpZgoKI2VuZGlmCgojaWZkZWYgU1QKaWYoKHomMXUpIT0wdSl2Q29sb3IueHl6PW1peCh2Q29sb3IueHl6LGgueHl6LGgudyk7ZWxzZSBpZigoeiY4dSkhPTB1KXZDb2xvci54eXo9bWl4KHZDb2xvci54eXosci54eXosci53KTsKI2VuZGlmCnZlYzIgZD1aKm1pbihfLngsMTAyNC4pLGo9dmVjMihaLnksLVoueCkqbWluKF8ueSwxMDI0Lik7dlBvc2l0aW9uPXBvc2l0aW9uO2dsX1Bvc2l0aW9uPXZlYzQoQS54eSt2ZWMyKHBvc2l0aW9uLngqZCtwb3NpdGlvbi55KmopKncsQS56LDEpOwojaWZkZWYgVVNFX0ZPRwp2Rm9nRGVwdGg9LVQuejsKI2VuZGlmCn0=",RQ=Object.freeze(Object.defineProperty({__proto__:null,code:FQ},Symbol.toStringTag,{value:"Module"})),UQ="cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwojZGVmaW5lIHZhcnlpbmcgaW4KdmFyeWluZyB2ZWM0IHZDb2xvcjt2YXJ5aW5nIHZlYzIgdlBvc2l0aW9uO3ZhcnlpbmcgZmxvYXQgdkRlcHRoOwojaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+Cm91dCB2ZWM0IG91dENvbG9yO3ZvaWQgbWFpbigpe2Zsb2F0IHY9ZG90KHZQb3NpdGlvbix2UG9zaXRpb24pO2lmKHY+NC4pZGlzY2FyZDtvdXRDb2xvcj12ZWM0KHZDb2xvci54eXosZXhwKC12KSp2Q29sb3Iudyk7CiNkZWZpbmUgZ2xfRnJhZ0NvbG9yIG91dENvbG9yCgojaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PgoKI3VuZGVmIGdsX0ZyYWdDb2xvcgpnbF9GcmFnRGVwdGg9dkRlcHRoO30=",kQ=Object.freeze(Object.defineProperty({__proto__:null,code:UQ},Symbol.toStringTag,{value:"Module"})),qg=class xg extends w.RawShaderMaterial{constructor(){var A;const{uniforms:I,defines:Q}=U(A=xg,sI,jI).call(A);super({uniforms:I,defines:Q,vertexShader:atob(MQ.code),fragmentShader:atob(JQ.code),transparent:!0,alphaTest:1,blending:w.NormalBlending,depthTest:!0,depthWrite:!1,side:w.FrontSide,glslVersion:w.GLSL3}),o(this,y),this.needsUpdate=!1}set basisViewport(A){this.uniforms.w.value.set(2/A.x,2/A.y),this.uniformsNeedUpdate=!0}set cameraNear(A){this.uniforms.z.value=A,this.uniformsNeedUpdate=!0}get cameraNear(){return this.uniforms.z.value}set cameraPosition(A){this.uniforms.f.value.copy(A),this.uniformsNeedUpdate=!0}get cameraPosition(){return this.uniforms.f.value}set dynamicMode(A){if(this.dynamicMode!==A){if(A){const I=[];for(let Q=0;Q<iI.MaxScenes;Q++)I.push(new w.Matrix4);this.uniforms.m={value:I},this.defines.DM=1}else delete this.defines.DM;this.needsUpdate=!0}}get dynamicMode(){return this.defines.DM===1}set focalLength(A){this.uniforms.t.value.copy(A),this.uniformsNeedUpdate=!0}set fog(A){this.fog!==A&&(A?this.defines.USE_FOG=1:delete this.defines.USE_FOG,this.needsUpdate=!0)}get fog(){return this.defines.USE_FOG===1}set fogExp2(A){this.fogExp2!==A&&(A?this.defines.FOG_EXP2=1:delete this.defines.FOG_EXP2,this.needsUpdate=!0)}get fogExp2(){return this.defines.FOG_EXP2===1}set halfPrecisionPositions(A){this.halfPrecisionPositions!==A&&(A?this.defines.PHF=1:delete this.defines.PHF,this.needsUpdate=!0)}get halfPrecisionPositions(){return this.defines.PHF===1}get nativeAntialiasing(){return this.defines.NAA===1}set nativeAntialiasing(A){this.nativeAntialiasing!==A&&(A?this.defines.NAA=1:delete this.defines.NAA,this.needsUpdate=!0)}set useStates(A){this.useStates!==A&&(A?this.defines.ST=1:(B(this,y,n)!==void 0&&(B(this,y,n).dispose(),i(this,y,void 0,eA)),delete this.defines.ST),this.needsUpdate=!0)}get useStates(){return this.defines.ST===1}get stateBuffer(){var A;return(A=B(this,y,n))==null?void 0:A.image.data}setTransform(A,I){this.uniforms.m.value[I].copy(A),this.uniformsNeedUpdate=!0}dispose(){super.dispose(),this.disposeTextures()}disposeTextures(){B(this,y,gA)&&(B(this,y,gA).dispose(),i(this,y,void 0,SI)),B(this,y,n)&&(B(this,y,n).dispose(),i(this,y,void 0,eA)),B(this,y,KA)&&(B(this,y,KA).dispose(),i(this,y,void 0,YI))}buildTextures(A){this.disposeTextures();const I=1,Q=1,C=1,D=3,G=3,N=.5,R=4,M=D+C+G+N;let Y=A.getGaussianCount();const V=this.defines.DM===1,d=this.defines.ST===1,t=this.defines.PHF===1,Z=new Uint32Array(Y*G),S=new(t?Uint16Array:Uint32Array)(Y*D),AA=new Uint32Array(Y*C);U(this,y,PI).call(this,A,Z,S,AA);const x=this.computeTextureInfo(Y,R,M),s=new Uint32Array(x.dataLength),L=t?(F,J)=>{s[F]=S[J]|S[J+1]<<16,s[F+1]=S[J+2]}:(F,J)=>{s[F]=S[J],s[F+1]=S[J+1],s[F+2]=S[J+2]};for(let F=0;F<Y;F++){const J=F*8,h=F*3;L(J,h),s[J+4]=Z[h],s[J+5]=Z[h+1],s[J+6]=Z[h+2],s[J+7]=AA[F]}const W=new w.DataTexture(s,x.width,x.height,w.RGBAIntegerFormat,w.UnsignedIntType,w.UVMapping,w.ClampToEdgeWrapping,w.ClampToEdgeWrapping,w.NearestFilter,w.NearestFilter,0);if(W.internalFormat="RGBA32UI",W.needsUpdate=!0,i(this,y,W,SI),d){const F=this.computeTextureInfo(Y,1,1),J=new Uint8Array(F.dataLength),h=new w.DataTexture(J,F.width,F.height,w.RedIntegerFormat,w.UnsignedByteType,w.UVMapping,w.ClampToEdgeWrapping,w.ClampToEdgeWrapping,w.NearestFilter,w.NearestFilter,0);h.needsUpdate=!0,i(this,y,h,eA)}if(V){const F=this.computeTextureInfo(Y,I,Q),J=new Uint32Array(F.width*F.height*I);let h=0,k=0;for(let UI=0;UI<A.numClouds();++UI){const WI=A.getCloudAt(UI),pg=WI.buffer.getGaussianCount();for(let kI=k;kI<pg;++kI)J[kI]=h;++h,k+=WI.globalSplatOffset}const RI=new w.DataTexture(J,F.width,F.height,w.RedIntegerFormat,w.UnsignedIntType,w.UVMapping,w.ClampToEdgeWrapping,w.ClampToEdgeWrapping,w.NearestFilter,w.NearestFilter,0);RI.internalFormat="R32UI",RI.needsUpdate=!0,i(this,y,RI,YI)}const IA=Math.floor(x.width/x.texelsPerSplat)-1,e=Math.floor(Math.log2(x.width/x.texelsPerSplat));(this.defines.TWOTPS!==IA||this.defines.ETWOTPS!==e||this.defines.TPS!==x.texelsPerSplat)&&(this.defines.TWOTPS=IA,this.defines.ETWOTPS=e,this.defines.TPS=x.texelsPerSplat,this.needsUpdate=!0)}computeTextureInfo(A,I,Q){const D=Math.ceil(Q/I),G=D*I;let N=1,R=A*G;for(;N*N<R;)N*=2;N>8192&&(N=8192,console.warn("Maximum splats count reached. Limiting to %s splats.",A));const M=Math.max(Math.ceil(R/N/I),1);return{width:N,height:M,dataLength:N*M*G,texelsPerSplat:D,paddedElementsPerSplat:G}}invalidateState(){B(this,y,n)&&(B(this,y,n).needsUpdate=!0,this.needsUpdate=!0)}fillSHIndices(A){const I=new Uint32Array(B(this,y,gA).image.data.buffer),Q=A.length;for(let C=0;C<Q;++C)I[C*8+3]|=A[C]<<16;B(this,y,gA).needsUpdate=!0}};y=new WeakSet,gA=function(){return this.uniforms.S.value},SI=function(g){B(this,y,gA)&&B(this,y,gA).dispose(),this.uniforms.S.value=g,this.uniformsNeedUpdate=!0},n=function(){return this.uniforms.x.value},eA=function(g){B(this,y,n)&&B(this,y,n).dispose(),this.uniforms.x.value=g,this.uniformsNeedUpdate=!0},KA=function(){return this.uniforms.y.value},YI=function(g){B(this,y,KA)&&B(this,y,KA).dispose(),this.uniforms.y.value=g,this.uniformsNeedUpdate=!0},PI=function(g,A,I,Q){for(let C=0;C<g.numClouds();++C){const D=g.getCloudAt(C);A&&D.fillPendingCovariancesData(A),I&&D.fillPendingPositionsData(I),Q&&D.fillPendingColorsData(Q)}},sI=new WeakSet,jI=function(){const g=Xg.merge([{S:{value:null},R:{value:null},x:{value:null},y:{value:null},t:{value:new w.Vector2},w:{value:new w.Vector2},z:{value:.1},f:{value:new w.Vector3}},Og.fog]),A={MAX_SCENES:iI.MaxScenes,TWOTPS:1,ETWOTPS:1,TPS:1};return{uniforms:g,defines:A}},o(qg,sI);let yQ=qg;const MQ=RQ,JQ=kQ,hQ={type:"change"};class PA extends w.EventDispatcher{constructor(){super(),c(this,"_uniforms"),c(this,"_defines"),this._uniforms=[],this._defines=[]}get uniforms(){return this._uniforms}get defines(){return this._defines}dispose(){}init(A){}update(A,I){}dispatchChange(){this.dispatchEvent(hQ)}}var O=(g=>(g.IDLE="idle",g.PLAYING="playing",g.COMPLETED="completed",g))(O||{});class jA extends PA{constructor(){super(...arguments),c(this,"disposeOnComplete",!0),o(this,GA,O.IDLE)}get state(){return B(this,GA)}play(){B(this,GA)==O.IDLE&&this.setState(O.PLAYING)}stop(){B(this,GA)==O.PLAYING&&this.setState(O.IDLE)}setState(A){i(this,GA,A),this.dispatchEvent({type:"stateChanged",state:A})}}GA=new WeakMap;const cQ={type:"refresh"},OI=class Tg extends w.Mesh{constructor(A){var I;super(U(I=Tg,vA,LI).call(I,0),new yQ),o(this,a),c(this,"isGaussianSplattingGroup",!0),c(this,"boundingBox",null),c(this,"gaussianState"),o(this,b),o(this,X,!1),o(this,QA),o(this,oA),o(this,uA),o(this,HA),o(this,NA),o(this,qA),o(this,KI,(()=>{const Q=new w.Vector2,C=new w.Vector2,D=new w.Vector2;return(G,N)=>{G.getSize(C);let R=G.getPixelRatio();if(G.xr.isPresenting&&(R*=window.devicePixelRatio/R),C.multiplyScalar(R),D.set(N.projectionMatrix.elements[0]*C.x*.5,N.projectionMatrix.elements[5]*C.y*.5),!D.equals(Q)||B(this,X)){N instanceof w.PerspectiveCamera&&(N.aspect=C.x/C.y,N.updateProjectionMatrix()),Q.copy(D);const M=this.material;M.basisViewport=C,M.focalLength=D}}})()),o(this,HI,(()=>{let Q=new w.Vector3;return C=>{const D=this.material;B(this,NA).copy(this.matrixWorld).invert().multiply(C.matrixWorld),Q.setFromMatrixPosition(B(this,NA)),(!Q.equals(D.cameraPosition)||B(this,X))&&(D.cameraPosition=Q),C instanceof w.PerspectiveCamera&&(C.near!=D.cameraNear||B(this,X))&&(D.cameraNear=C.near)}})()),this.type="GaussianSplattingGroup",i(this,uA,(A?.useSharedMemory??!0)&&crossOriginIsolated),i(this,oA,A?.dynamicMode??!1),i(this,HA,A?.useStates??!1),i(this,b,new NQ(B(this,oA),B(this,uA))),B(this,b).addEventListener(XI.INIT,U(this,a,_I).bind(this)),B(this,b).addEventListener(XI.READY,U(this,a,$I).bind(this)),this.frustumCulled=!1,i(this,NA,new w.Matrix4),i(this,QA,()=>{U(this,a,dA).call(this)})}set fx(A){A instanceof PA&&(A=[A]),U(this,a,aI).call(this,B(this,qA),A),i(this,qA,A)}get fx(){return B(this,qA)}add(...A){let I=0;if(this.children.length>0){const C=this.children[this.children.length-1];I=C.globalSplatOffset+C.buffer.getGaussianCount()}const Q=this.children.length;for(const C of A)C.isGaussianCloud&&(C.globalSplatOffset=I,I+=C.buffer.getGaussianCount(),super.add(C));return Q!==this.children.length&&i(this,X,!0),this}remove(...A){const I=this.children.length;for(const Q of A)Q.isGaussianCloud&&super.remove(Q);return I!==this.children.length&&i(this,X,!0),this}removeCloudAt(A){if(A<0||A>=this.children.length)throw new Error("SplatMesh::getScene() -> Invalid scene index.");return this.remove(this.getCloudAt(A)),i(this,X,!0),this}getCloudAt(A){if(A<0||A>=this.children.length)throw new Error("SplatMesh::getScene() -> Invalid scene index.");return this.children[A]}numClouds(){return this.children.length}getGaussianCount(){return this.children.reduce((A,I)=>A+I.buffer.getGaussianCount(),0)}computeBoundingBox(){this.boundingBox===null?this.boundingBox=new w.Box3:this.boundingBox.makeEmpty();for(const A of this.children){const I=A;I.boundingBox===null&&I.computeBoundingBox();const Q=I.boundingBox.applyMatrix4(I.matrix);this.boundingBox.union(Q)}}raycast(A,I){}dispose(){U(this,a,mI).call(this),B(this,b).dispose(),i(this,X,!0)}invalidateState(){B(this,HA)&&(this.material.invalidateState(),U(this,a,dA).call(this))}onBeforeRender(A,I,Q){B(this,X)&&(this.dispose(),this.numClouds()>0&&U(this,a,fI).call(this)),this.children.length!==0&&(B(this,HI).call(this,Q),B(this,KI).call(this,A,Q),U(this,a,zI).call(this),U(this,a,eI).call(this,Q),U(this,a,uI).call(this,I),B(this,b).update(B(this,NA)),i(this,X,!1))}};b=new WeakMap,X=new WeakMap,QA=new WeakMap,oA=new WeakMap,uA=new WeakMap,HA=new WeakMap,NA=new WeakMap,qA=new WeakMap,vA=new WeakSet,LI=function(g){const A=new w.InstancedBufferGeometry;A.setIndex([0,1,2,0,2,3]);const I=new w.BufferAttribute(new Float32Array([-2,-2,2,-2,2,2,2,2,-2,2,-2,-2]),3);A.setAttribute("position",I),A.boundingSphere=new w.Sphere(new w.Vector3,1),I.needsUpdate=!0;const Q=new Int32Array(g),C=new w.InstancedBufferAttribute(Q,1,!1);return C.setUsage(w.DynamicDrawUsage),C.gpuType=w.IntType,A.setAttribute("v",C),A.instanceCount=0,A},a=new WeakSet,fI=function(){var g;const A=this.getGaussianCount();this.geometry=U(g=OI,vA,LI).call(g,A),this.material.dynamicMode=B(this,oA),this.material.useStates=B(this,HA),this.material.halfPrecisionPositions=BI(),this.material.buildTextures(this),this.gaussianState=this.material.stateBuffer,this.fx&&U(this,a,aI).call(this,void 0,this.fx),B(this,b).init(A)},aI=function(g,A){g=g??[],A=A??[];const I=g.filter(C=>!A.includes(C)),Q=A.filter(C=>!g.includes(C));if(this.material&&(Q.length>0||I.length>0)){for(const C of I){if(C.uniforms)for(const D of C.uniforms)delete this.material.uniforms[D];if(C.defines)for(const D of C.defines)delete this.material.defines[D];C.removeEventListener("change",B(this,QA)),C instanceof jA&&C.removeEventListener("stateChanged",B(this,QA))}for(const C of Q)C.init(this.material),C.addEventListener("change",B(this,QA)),C instanceof jA&&C.addEventListener("stateChanged",B(this,QA));this.material.needsUpdate=!0}},dA=function(){this.dispatchEvent(cQ)},mI=function(){this.geometry.dispose(),this.material&&this.material.dispose()},rI=function(g,A){const I=this.geometry,Q=I.attributes.v;Q.set(g,0),Q.addUpdateRange(0,g.length),Q.needsUpdate=!0,I.instanceCount=A},zI=function(){const g=this.material;let A=!1;for(let I=0;I<this.children.length;I++){const Q=this.children[I];Q.matrixNeedsUpdate&&(Q.updateMatrix(),B(this,oA)&&g.setTransform(Q.matrix,I),A=!0)}A&&this.boundingBox!==null&&this.computeBoundingBox()},KI=new WeakMap,HI=new WeakMap,eI=function(g){if(this.fx)for(let A=this.fx.length-1;A>=0;--A){const I=this.fx[A];if(I instanceof jA&&I.state===O.COMPLETED&&I.disposeOnComplete){I.dispose();const Q=this.fx.concat();Q.splice(A,1),this.fx=Q}I.update(this,g)}},uI=function(g){const A=this.material;A.fog=g.fog!==null,A.fogExp2=g.fog!==null&&g.fog.isFogExp2},vI=function(){const g=BI()?Uint16Array:Float32Array,A=new g(this.getGaussianCount()*3);let I=0;for(const Q of this.children){const C=Q,D=C.buffer.getGaussianCount()*3,G=new g(SA().buffer,C.buffer.getPositionsBufferPtr(),D);A.set(G,I),I+=D}return A},_I=function(g){B(this,b).addPositions(U(this,a,vI).call(this),0,BI()),this.computeBoundingBox(),B(this,b).setBounds(this.boundingBox.min,this.boundingBox.max),U(this,a,dA).call(this)},$I=function(g){const A=g.data;U(this,a,rI).call(this,A.indices,A.renderCount),U(this,a,dA).call(this)},o(OI,vA);let SQ=OI;const dg=new w.Matrix4,wI=new w.Ray;class tg extends w.Object3D{constructor(A){super(),o(this,tA),c(this,"isGaussianCloud",!0),c(this,"buffer"),c(this,"centerRadiusStep"),c(this,"centerRadiusList"),c(this,"sceneCenter"),c(this,"globalSplatOffset",0),c(this,"matrixNeedsUpdate",!0),c(this,"boundingBox",null),o(this,_A,0),o(this,$A,0),o(this,AI,0),this.buffer=A,this.frustumCulled=!1,this.type="GaussianCloud",this.centerRadiusList=A.getCenterRadiusList(),this.centerRadiusStep=A.getCenterRadiusStep();const I=A.getSceneCenter();this.sceneCenter=new w.Vector3(I[0],I[1],I[2])}get gaussianState(){const A=this.parent;if(A&&A.gaussianState)return new Uint8Array(A.gaussianState.buffer,this.globalSplatOffset,this.buffer.getGaussianCount())}get metadata(){return JSON.parse(this.buffer.getMetadata())}dispose(){this.buffer&&this.buffer.free()}computeBoundingBox(){this.boundingBox===null?this.boundingBox=new w.Box3:this.boundingBox.makeEmpty();let A=this.buffer.getBoundsMin(),I=this.buffer.getBoundsMax();this.boundingBox.set(new w.Vector3(A[0],A[1],A[2]),new w.Vector3(I[0],I[1],I[2]))}raycast(A,I){if(dg.copy(this.matrixWorld).invert(),wI.copy(A.ray).applyMatrix4(dg),this.boundingBox===null&&this.computeBoundingBox(),!wI.intersectsBox(this.boundingBox))return;const Q=this.buffer.raycast(wI.origin,wI.direction,!1,A.firstHitOnly??!1);for(const C of Q)C.distance>=A.near&&C.distance<=A.far&&I.push({distance:C.distance,point:new w.Vector3().set(C.point.x,C.point.y,C.point.z).applyMatrix4(this.matrixWorld),object:this,instanceId:C.index}),C.point.free(),C.free()}updateMatrix(){this.matrixNeedsUpdate&&(super.updateMatrix(),this.matrixNeedsUpdate=!1)}fillPendingPositionsData(A){const I=this.buffer.getLoadedPositionsCount();U(this,tA,II).call(this,A,wg()/A.BYTES_PER_ELEMENT,B(this,_A),I,this.buffer.getPositionsBufferPtr()),i(this,_A,I)}fillPendingColorsData(A){const I=this.buffer.getLoadedColorsCount();U(this,tA,II).call(this,A,Gg()/A.BYTES_PER_ELEMENT,B(this,$A),I,this.buffer.getColorsBufferPtr()),i(this,$A,I)}fillPendingCovariancesData(A){const I=this.buffer.getLoadedCovariancesCount();U(this,tA,II).call(this,A,og()/A.BYTES_PER_ELEMENT,B(this,AI),I,this.buffer.getCovariancesBufferPtr()),i(this,AI,I)}invalidateState(){const A=this.parent;A&&A.invalidateState()}}_A=new WeakMap,$A=new WeakMap,AI=new WeakMap,tA=new WeakSet,II=function(g,A,I,Q,C){const D=Q-I;if(D>0){let G=Object.getPrototypeOf(g).constructor,N=new G(SA().buffer,C+I*A,D*A);g.set(N,(this.globalSplatOffset+I)*A)}};var Vg=(g=>(g[g.NONE=0]="NONE",g[g.SELECTED=1]="SELECTED",g[g.DELETED=2]="DELETED",g[g.HIDDEN=4]="HIDDEN",g[g.HOVERED=8]="HOVERED",g))(Vg||{});const fA=class YA extends w.Loader{constructor(A){super(A),o(this,gI),o(this,xA),i(this,xA,Math.min(navigator.hardwareConcurrency,4))}setWorkerLimit(A){return i(this,xA,A),this}async load(A,I,Q,C){if(B(YA,FA)){B(YA,VA).push({url:A,onLoad:I,onProgress:Q,onError:C,loader:this});return}i(YA,FA,!0),await ag(B(this,xA)),Ng(A,(D,G)=>{Q&&Q(new ProgressEvent("progress",{loaded:D,total:G}))}).then(D=>{i(YA,FA,!1);let G=new tg(D);U(this,gI,qI).call(this),I(G)}).catch(D=>{i(YA,FA,!1),U(this,gI,qI).call(this),C&&C(D)})}};VA=new WeakMap,FA=new WeakMap,xA=new WeakMap,gI=new WeakSet,qI=function(){if(B(fA,VA).length>0){let g=B(fA,VA).shift();g.loader.load(g.url,g.onLoad,g.onProgress,g.onError)}},o(fA,VA,[]),o(fA,FA,!1);let YQ=fA;class sQ extends PA{constructor(){super(),o(this,QI),o(this,CA,.3),o(this,RA,!1),o(this,UA,!0),this._uniforms.push("u"),this._defines.push("COVAA","NAA"),U(this,QI,dI).call(this)}get value(){return B(this,CA)}set value(A){A=Math.max(0,Math.min(1,A)),B(this,CA)!=A&&(i(this,CA,A),i(this,UA,!0),this.dispatchChange())}get native(){return B(this,RA)}set native(A){B(this,RA)!=A&&(i(this,RA,A),i(this,UA,!0),this.dispatchChange())}init(A){A.uniforms.u={value:B(this,CA)},A.defines[this._defines[0]]=1}update(A,I){const Q=A.material;B(this,UA)&&(B(this,RA)?(Q.defines.NAA=1,Q.needsUpdate=!0):(Q.defines.NAA&&(delete Q.defines.NAA,Q.needsUpdate=!0),Q.uniforms.u.value=B(this,CA),Q.uniformsNeedUpdate=!0),i(this,UA,!1))}}CA=new WeakMap,RA=new WeakMap,UA=new WeakMap,QI=new WeakSet,dI=function(){var g,A;const I=new lI;I.isActive()?((g=I.ui)==null||g.add(this,"value",0,1,.01).name("Antialias"),(A=I.ui)==null||A.add(this,"native",!1).name("Native Antialias")):I.addEventListener("change",Q=>{U(this,QI,dI).call(this)})};class LQ extends PA{constructor(){super(),o(this,EA),o(this,BA,3),o(this,P),o(this,f),o(this,u),o(this,v),o(this,kA,!0),o(this,yA,!1),this._uniforms.push("R"),this._defines.push("SH","SH1","SH2","SH3","SHCB16","TWOTPS_SH","TPS_SH","ETWOTPS_SH");for(let A=0;A<15;A++)this._defines.push(`SHL${A}`),this._defines.push(`SHH${A}`);U(this,EA,tI).call(this)}get maxDegree(){return B(this,BA)}set maxDegree(A){B(this,BA)!=A&&(i(this,BA,A),i(this,kA,!0),this.dispatchChange())}init(A){A.uniforms.R={value:void 0}}dispose(){B(this,P)&&(B(this,P).dispose(),i(this,P,void 0)),B(this,f)&&(B(this,f).dispose(),i(this,f,void 0)),B(this,u)&&(B(this,u).dispose(),i(this,u,void 0)),B(this,v)&&(B(this,v).dispose(),i(this,v,void 0))}update(A,I){const Q=A.material;if(!B(this,P)&&!B(this,f)&&!B(this,u)&&!B(this,v)&&(i(this,yA,A.children.some(C=>{if(C.isGaussianCloud){const D=C;return D.buffer.getSHCBCount()==0&&D.buffer.getSHDegree()>0}return!1})),B(this,yA)?(U(this,EA,gg).call(this,A),Q.uniforms.H={value:B(this,f)},Q.uniforms.A={value:B(this,u)},Q.uniforms.B={value:B(this,v)},i(this,kA,!0)):(U(this,EA,Ig).call(this,A),U(this,EA,Ag).call(this,A),Q.uniforms.R={value:B(this,P)}),Q.uniformsNeedUpdate=!0),B(this,kA)){for(const C of this._defines)delete Q.defines[C];if(B(this,BA)>0){Q.defines.SH=1,B(this,yA)||(Q.defines.SHCB16=1);for(let C=0;C<B(this,BA);C++)Q.defines[`SH${C+1}`]=1}if(B(this,yA)){const C=B(this,f).image.width,D=C-1,G=Math.floor(Math.log2(C));Q.defines.TWOTPS_SH=D,Q.defines.ETWOTPS_SH=G}Q.needsUpdate=!0,i(this,kA,!1)}}}BA=new WeakMap,P=new WeakMap,f=new WeakMap,u=new WeakMap,v=new WeakMap,kA=new WeakMap,yA=new WeakMap,EA=new WeakSet,tI=function(){var g;const A=new lI;A.isActive()?(g=A.ui)==null||g.add(this,"maxDegree",0,3,1).name("SH degree"):A.addEventListener("change",I=>{U(this,EA,tI).call(this)})},Ag=function(g){const A=g.getGaussianCount();let I=0;const Q=new Uint16Array(A);for(let D=0,G=g.numClouds();D<G;++D){const N=g.getCloudAt(D),R=N.buffer.getGaussianCount(),M=new Uint16Array(SA().buffer,N.buffer.getShCoeffsIndicesBufferPtr(),R);Q.set(M,I),I+=R}g.material.fillSHIndices(Q)},Ig=function(g){let D=0;for(let Y=0,V=g.numClouds();Y<V;++Y){const d=g.getCloudAt(Y);D+=d.buffer.getSHCBCount()}const G=1024/4,N=new w.Vector2(1024,Math.max(Math.ceil(D/G)*4,1)),R=new Uint16Array(N.x*N.y*3);let M=0;for(let Y=0,V=g.numClouds();Y<V;++Y){const d=g.getCloudAt(Y),t=d.buffer.getSHCBCount(),Z=new Uint16Array(SA().buffer,d.buffer.getShCoeffsCBBufferPtr(),t*45);for(let S=0;S<t;++S){const AA=S+M,x=AA%G,s=Math.floor(AA/G);let L=AA*45;for(let W=0;W<4;++W){const IA=(s*4+W)*1024*3;for(let e=0;e<4;++e){const F=(x*4+e)*3,J=IA+F;R[J]=Z[L++],R[J+1]=Z[L++],R[J+2]=Z[L++]}}}M+=t}i(this,P,new w.DataTexture(R,N.x,N.y,w.RGBFormat,w.HalfFloatType)),B(this,P).internalFormat="RGB16F",B(this,P).needsUpdate=!0},gg=function(g){let Q=g.getGaussianCount();const D=g.material.computeTextureInfo(Q,4,15),G=new Uint8Array(D.dataLength),N=new Uint8Array(D.dataLength),R=new Uint8Array(D.dataLength),M=Math.floor(.5*255);for(let V=0,d=g.numClouds();V<d;++V){const t=g.getCloudAt(V),Z=t.buffer.getSHCBCount(),S=t.buffer.getSHDegree(),x=((S+1)*(S+1)-1)*3,s=t.buffer.getGaussianCount();if(S<3&&(R.fill(M,0,s*D.paddedElementsPerSplat),S<2&&(N.fill(M,0,s*D.paddedElementsPerSplat),S<1&&G.fill(M,0,s*D.paddedElementsPerSplat))),Z==0){const L=new Uint8Array(SA().buffer,t.buffer.getShCoeffsBufferPtr(),s*x),W=S>1?15:12,IA=S>2?15:12,e=S==3?15:12;let F=0;for(let J=0;J<s;++J)if(S>=1){const h=J*D.paddedElementsPerSplat;F=J*x;for(let k=0;k<W;k+=4,F+=4)G[h+k]=L[F+3],G[h+k+1]=L[F+2],G[h+k+2]=L[F+1],G[h+k+3]=L[F];if(S>=2){F--;for(let k=0;k<IA;k+=4,F+=4)N[h+k]=L[F+3],N[h+k+1]=L[F+2],N[h+k+2]=L[F+1],N[h+k+3]=L[F];if(S==3){F--;for(let k=0;k<e;k+=4,F+=4)R[h+k]=L[F+3],R[h+k+1]=L[F+2],R[h+k+2]=L[F+1],R[h+k+3]=L[F]}else for(let k=IA;k<D.paddedElementsPerSplat;++k)N[h+k]=M}else for(let k=W;k<D.paddedElementsPerSplat;++k)G[h+k]=M}}}const Y=[G,N,R].map(V=>{const d=new w.DataTexture(new Uint32Array(V.buffer),D.width,D.height,w.RGBAIntegerFormat,w.UnsignedIntType);return d.internalFormat="RGBA32UI",d.needsUpdate=!0,d});i(this,f,Y[0]),i(this,u,Y[1]),i(this,v,Y[2])};class aQ extends jA{constructor(){super(),o(this,CI),c(this,"sparseFadeFactor",.1),c(this,"denseFadeFactor",.1),c(this,"denseTimeDelay",3),c(this,"speedFactor",.25),c(this,"minimumPointSize",2),o(this,T),o(this,_,0),o(this,DA,0),o(this,TA,0),o(this,MA,0),o(this,JA,0),o(this,pA,0),o(this,hA,0),o(this,cA,0),o(this,ZA,0),this._uniforms.push("D","i","p","n"),this._defines.push("RFIA","RFIA_SS")}dispose(){super.dispose(),B(this,T)&&(B(this,T).stop(),i(this,T,void 0))}stop(){this.state==O.PLAYING&&(i(this,_,0),i(this,DA,0),i(this,TA,0),i(this,MA,0),i(this,JA,0),i(this,pA,0),i(this,hA,0),i(this,cA,0),i(this,ZA,0),B(this,T)&&(B(this,T).stop(),i(this,T,void 0))),super.stop()}init(A){A.uniforms.D={value:new w.Vector2},A.uniforms.i={value:new w.Vector2},A.uniforms.p={value:new w.Vector2},A.uniforms.n={value:new w.Vector3},A.defines[this._defines[0]]=1}update(A,I){if(this.state!=O.PLAYING)return;const Q=A.getCloudAt(0),C=Q.buffer,D=A.material;B(this,T)||(i(this,T,new w.Clock),this.speedFactor=xI.clamp(this.speedFactor,.01,1),this.sparseFadeFactor=xI.clamp(this.sparseFadeFactor,0,.99),this.denseFadeFactor=xI.clamp(this.denseFadeFactor,0,.99),D.uniforms.n.value.copy(Q.sceneCenter.clone()),D.defines[this._defines[1]]!=this.minimumPointSize&&(D.defines[this._defines[1]]=this.minimumPointSize,D.needsUpdate=!0));const G=C.getMaximumRadius()*1.05;if(B(this,_)>=.99&&B(this,DA)>=.99&&B(this,JA)>=G&&B(this,cA)>=G){B(this,T).stop(),i(this,T,void 0),this.setState(O.COMPLETED);return}const N=Math.max(C.getCurrentRadius(),.001),R=B(this,T).getElapsedTime();i(this,_,B(this,_)*.9+N*.1),i(this,DA,B(this,DA)*.95+N*.05),i(this,TA,1/(B(this,_)-B(this,DA)));let M=Math.max(U(this,CI,VI).call(this,R)*G,.001);i(this,MA,M*(1+this.sparseFadeFactor)),i(this,JA,M*(1-this.sparseFadeFactor)),i(this,pA,1/(B(this,MA)-B(this,JA))),M=Math.max(U(this,CI,VI).call(this,Math.max(R-this.denseTimeDelay,0))*G,.001),i(this,hA,M*(1+this.denseFadeFactor)),i(this,cA,M*(1-this.denseFadeFactor)),i(this,ZA,1/(B(this,hA)-B(this,cA))),D.uniforms.i.value.set(B(this,_),B(this,TA)),D.uniforms.p.value.set(B(this,MA),B(this,pA)),D.uniforms.D.value.set(B(this,hA),B(this,ZA)),D.uniformsNeedUpdate=!0,this.dispatchChange()}}T=new WeakMap,_=new WeakMap,DA=new WeakMap,TA=new WeakMap,MA=new WeakMap,JA=new WeakMap,pA=new WeakMap,hA=new WeakMap,cA=new WeakMap,ZA=new WeakMap,CI=new WeakSet,VI=function(g){return Math.pow(g*this.speedFactor,2.5)},new w.Matrix4,new w.Euler(0,0,0,"YXZ"),new w.Quaternion,new w.Vector3;const KQ="0.1.36";export{jA as AnimationFx,sQ as AntialiasingFx,PA as Fx,tg as GaussianCloud,YQ as GaussianCloudLoader,SQ as GaussianSplattingGroup,Vg as GaussianState,aQ as RadialFadeInAnimationFx,LQ as SphericalHarmonicsFx,O as StateFx,KQ as version};
